<html>

<head>
	<title>RE Calculator</title>
	<style>

	</style>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>

<body>
	<!-- some HTML -->
	<div id="root"></div>
	<!-- some other HTML -->
</body>

</html>

<div>
	<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
	<!-- babel is required in order to parse JSX -->

	<script src="https://unpkg.com/react@16/umd/react.development.js"></script>
	<!-- import react.js -->

	<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"> </script>
	<!-- import react-dom.js -->

	<!-- <script src="https://unpkg.com/react-use-localstorage@3.4.1/dist/react-use-localstorage.cjs.development.js">
	</script> -->
	<!-- import localstorage.js -->

	<!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"> </script> -->
	<!-- import bootstrap.js -->

	<!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
		integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"> -->

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" />

	<!-- <script src="https://unpkg.com/react/umd/react.production.min.js" crossorigin></script> -->

	<!-- // <script
	// 	src="https://unpkg.com/react-dom/umd/react-dom.production.min.js"
	// 	crossorigin
	// /> -->

	<script src="https://unpkg.com/react-bootstrap@next/dist/react-bootstrap.min.js" crossorigin></script>

	<!-- // <script>
		var Alert = ReactBootstrap.Alert;
	</script> -->


	<script type="text/babel">

		function useLocalStorage(key, initialValue) {
			// State to store our value
			// Pass initial state function to useState so logic is only executed once
			const [storedValue, setStoredValue] = React.useState(() => {
				try {
				// Get from local storage by key
				const item = window.localStorage.getItem(key);
				// Parse stored json or if none return initialValue
				return item ? JSON.parse(item) : initialValue;
				} catch (error) {
				// If error also return initialValue
				console.log(error);
				return initialValue;
				}
			});

			// Return a wrapped version of useState's setter function that ...
			// ... persists the new value to localStorage.
			const setValue = value => {
				try {
				// Allow value to be a function so we have same API as useState
				const valueToStore =
					value instanceof Function ? value(storedValue) : value;
				// Save state
				setStoredValue(valueToStore);
				// Save to local storage
				window.localStorage.setItem(key, JSON.stringify(valueToStore));
				} catch (error) {
				// A more advanced implementation would handle the error case
				console.log(error);
				}
			};

			return [storedValue, setValue];
		}
		
		// Helper functions

		const Helpers = (() => {

			const calculateTotalProjectCost = ({purchasePrice, estimatedRepairs, purchaseClosingCosts, preRentHoldingCosts } = form) => {
				const totalProjectCost =
				(purchasePrice || 0) +
				(estimatedRepairs || 0) +
				(purchaseClosingCosts || 0) +
				(preRentHoldingCosts || 0);
				return totalProjectCost;
			}
			
			return {
				calculateTotalProjectCost: calculateTotalProjectCost
			}
		})();


		Number.prototype.toCurrency = function(){
			console.log("this.valueOf: " + this.valueOf());

			if (isNaN(this.valueOf()))
			{
				return 0;
			}

			const formattedValue =  this.valueOf().toLocaleString(undefined, {maximumFractionDigits:2});
			console.log("formattedValue: " + formattedValue);

			return formattedValue;
		}

		// end of Helper Functions

		const SingleInput = ({
		  label,
		  inputName,
          inputValue,
          additionalInfoText,
          handleOnChange,
          disabled,
          prefix,
          suffix,
          required,
          roundValue=true
        } = props) => {

			let isInvalid = "";
			if (required && !inputValue){
				isInvalid = "is-invalid"
			}

			const value = (roundValue ? Math.ceil(inputValue) : inputValue);

			return (
				<div className="input-group row py-1 ">
					<label  className="col-md-2">{label}</label>
					<div className="col-md-4">
					<div className="input-group">
						<div className="input-group-prepend">
						<span className="input-group-text">{prefix}</span>
						</div>
						<input className={"form-control " + isInvalid}
							type="number"
							name={inputName}
							value={value || ""}
							onChange={handleOnChange}
							disabled={disabled ? "disabled" : ""}
						/>
						<div className="input-group-append">
						<span className="input-group-text">{suffix}</span>
						</div>
					</div>
					</div>
					<div className="col-md-2">{additionalInfoText}</div>
				</div>
			);
		}

		const Part0 = ({ form, handleOnChange } = props) => {

			return (
				<div>
					<SingleInput
						label="Asking Price"
						inputName="askingPrice"
						inputValue={form.askingPrice}
						handleOnChange={handleOnChange}
						prefix={"$"}
					/>
				</div>
			);
		};

		// Total Project Cost
		const Part1 = ({
			form,
			handleOnChange
        } = props) => {
			return (
				<div>
					<h2>1) Total Project Cost: ${Helpers.calculateTotalProjectCost(form).toCurrency()}</h2>
					<SingleInput
						label="Purchase Price"
						inputValue={form.purchasePrice}
						inputName="purchasePrice"
						handleOnChange={handleOnChange}
						prefix={"$"}
						required="true"
					/>
					<SingleInput
						label="Purchase Closing Costs"
						inputValue={form.purchaseClosingCosts}
						inputName="purchaseClosingCosts"
						handleOnChange={handleOnChange}
						prefix={"$"}
					/>

					<SingleInput
						label="Pre-Rent Holding Costs"
						inputValue={form.preRentHoldingCosts}
						inputName="preRentHoldingCosts"
						handleOnChange={handleOnChange}
						prefix={"$"}
					/>

					<SingleInput
						label="Estimated Repairs"
						inputValue={form.estimatedRepairs}
						inputName="estimatedRepairs"
						handleOnChange={handleOnChange}
						prefix={"$"}
					/>

					<SingleInput
						label="Total Project Cost"
						inputValue={Helpers.calculateTotalProjectCost(form)}
						prefix={"$"}
						disabled={true}
					/>
				</div>
        	);
    	}
	
		const Defaults = ({defaults, handleOnSubmit} = props) => {

			const [localDefaults, setLocalDefaults] = React.useState({...defaults});

			const handleOnChange = (event) => {
				setLocalDefaults({
					...localDefaults,
					[event.target.name]: Number(event.target.value)
				});
			};

			const [showModal, setShowModal] = React.useState(false);

			const handleClose = () => setShowModal(false);
			const handleShow = () => setShowModal(true);

			const handleOnSumbit = () => {
				handleOnSubmit(localDefaults);

				handleClose();
			};

			return (
				<React.Fragment>
					<ReactBootstrap.Button variant="primary" onClick={handleShow} className="float-right">
						Edit Defaults
					</ReactBootstrap.Button>
					<ReactBootstrap.Modal show={showModal} onHide={handleClose} size="lg">
						<ReactBootstrap.Modal.Header closeButton>
						<ReactBootstrap.Modal.Title>Defaults</ReactBootstrap.Modal.Title>
						</ReactBootstrap.Modal.Header>
						<ReactBootstrap.Modal.Body>
							<form>
								<div>
									<SingleInput
										label="Default Purchase Closing Costs"
										inputName="purchaseClosingCosts"
										inputValue={localDefaults.purchaseClosingCosts}
										handleOnChange={handleOnChange}
										prefix={"$"}
									/>
									<SingleInput
										label="Default Loan Period"
										inputName="loanPeriod"
										inputValue={localDefaults.loanPeriod}
										handleOnChange={handleOnChange}
										suffix={"years"}
									/>
									<SingleInput
										label="Default Interest Rate"
										inputName="interestRate"
										inputValue={localDefaults.interestRate}
										handleOnChange={handleOnChange}
										suffix={"%"}
									/>
								</div>
							</form>	
						</ReactBootstrap.Modal.Body>
						<ReactBootstrap.Modal.Footer>
						<ReactBootstrap.Button variant="primary" onClick={handleOnSumbit}>
							Save Changes
						</ReactBootstrap.Button>
						</ReactBootstrap.Modal.Footer>
					</ReactBootstrap.Modal>
				</React.Fragment>
			);
		};

		const Container = () => {
			const [defaults, setDefaults] = useLocalStorage('defaults',"");
			// const [defaults, setDefaults] = React.useState({});

			const defaultsObject = defaults ? JSON.parse(defaults) : {};
			const [form, setState] = React.useState({
				...defaultsObject
			});

			React.useEffect(() => {
			}, [defaultsObject]);

			const handleOnChange = (e) => {
				setState({
					...form,
					[e.target.name]: Number(e.target.value)
				});

			};

			const handleDefaultsSubmission = (newDefaults) => {
				const newDefaultsString = JSON.stringify(newDefaults);

				setDefaults(newDefaultsString);
				const newForm = {...form, ...newDefaults};
				setState(newForm);
			};

			return (
				<div className="container">
					<h1 className="text-center">RE Calculator</h1>
					
					<hr className="solid"/>
					<Defaults defaults={defaultsObject} handleOnSubmit={handleDefaultsSubmission}/>
					<form>
						<Part0
							form={form}
							handleOnChange={handleOnChange}
						/>
						<Part1 
							form={form} 
							handleOnChange={handleOnChange}
						/>
					</form>
				</div>
			);
		}

		const element = (
			<div>
				<Container/>
			</div>
		);

		ReactDOM.render(
			element,
			document.getElementById('root')
		);

	</script>
</div>